<!DOCTYPE html>
<html>
  {% include meta.html %}
  <body>
    {% include ga.html %}
    <div id="wrapper">
      {% include header.html %}
      {% include nav.html %}
      <section id="project">
        {% if page.video or page.features %}
          <div id="features">
              <div id="poster">
                {% if page.video %}
                  <iframe class="video full" src="https://player.vimeo.com/video/{{ page.video }}" width="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                {% endif %}
                {% if page.features %}
                  {% for feature in page.features %}
                    <div class="full" style="background-image: url( {{ site.baseurl }}/media/features/{{ page.id }}/{{ forloop.index0 }}.png )"><span>{{ feature }}</span></div>
                  {% endfor %}
                {% endif %}
              </div>
          </div>
          <div id="thumbs">
            {% if page.video %}
              <div id="video-thumb" class="thumb"><span class="arrow"></span><img src="{{ site.baseurl }}/images/play.png" /></div>
            {% endif %}
            {% if page.features %}
              {% for feature in page.features %}
                <div class="thumb" style="background-image: url( {{ site.baseurl }}/media/features/{{ page.id }}/{{ forloop.index0 }}.png )"><span class="arrow"></span></div>
              {% endfor %}
            {% endif %}
          </div>
          <hr />
        {%  else %}
          <img src="{{ site.baseurl }}/media/slideshow/{{ page.id }}.png">
        {% endif %}
        <div class="content">
          <header>
            <h1>{{ page.title }}</h1>
            <b>{{ page.client }}</b><br />
            <em>{{ page.tag }}</em><br />
            {% if page.link %}
              <br /><a href="{{ page.link }}" target="_blank">View the map</a><br />
            {% endif %}
          </header>
          <hr />
          
          {{ content }}
          <hr />
          {% assign s = site.projects | where: "category", page.category | size %}
          {% if page.category and s > 1 %}
            <h2>More {{ page.category | downcase }} projects</h2>
            <ul>
              {% assign items = site.projects | sort: 'date' %}
              {% for project in items reversed %}
                {% if project.category == page.category and project.featured and project.title != page.title %}
                  <li><a href="{{ project.url | prepend: site.baseurl }}">{{ project.title }}</a></li>
                {% endif %}
              {% endfor %}
            </ul>
          {% endif %}
          
          {% assign blog = false %}
          {% assign posts = site.posts | sort: 'date' %}
          {% for post in posts %}
            {% if post.project == page.id %}
              {% assign blog = true %}
              {% break %}
            {% endif %}
          {% endfor %}
          {% if blog %}
            <h2>From the blog</h2>
            <ul>
              {% for post in posts reversed %}
                {% if post.project == page.id %}
                  <li><a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a></li>
                {% endif %}
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </section>
      {% include footer.html %}
    </div>
    <script>
      $( window ).resize( function(){
        $( '#poster' ).height( 720 * $( '#poster' ).width() / 1280 );
      });
      $( window ).resize();
      
      $( '.thumb' ).first().addClass( 'active' );
      $( '.full' ).first().addClass( 'active' );
      
      $( '.thumb' ).click( function(){
        $( '.active' ).removeClass( 'active' );
        $( this ).addClass( 'active' );
        $( $( "#poster" ).children()[ $( "#thumbs" ).children().index( $( this ) ) ] ).addClass( "active" );
      })
      
      {% if page.video %}
        $.getJSON( "http://vimeo.com/api/v2/video/{{ page.video }}.json", function( json ){
          $( "#video-thumb" ).css( "background-image", "url(" + json[ 0 ].thumbnail_medium + ")" );
        });
      {% endif %}
    </script>
  </body>
</html>
